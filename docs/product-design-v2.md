# Echo äº§å“è®¾è®¡ v2 - ç¦»çº¿ä¼˜å…ˆæ¶æ„

> æ›´æ–°æ—¶é—´: 2026-02-07

## è®¾è®¡ç†å¿µè°ƒæ•´

### æ ¸å¿ƒæ´å¯Ÿ

è¯­è¨€è¾“å‡ºçš„æ ¸å¿ƒåœ¨äº**ç§¯ç´¯**å’Œ**è¾“å‡º**ï¼ŒAI åº”è¯¥æ˜¯å¢å¼ºè€Œéå¿…éœ€ã€‚ç³»ç»Ÿåœ¨ç¦»çº¿æ—¶ä»åº”å®Œå…¨å¯ç”¨â€”â€”ç”¨æˆ·å¯ä»¥è¾“å…¥ã€æµè§ˆå†å²ã€è¾“å‡ºè¡¨è¾¾ã€‚

### æ¶æ„åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ ¸å¿ƒä»·å€¼å¾ªç¯ï¼ˆç¦»çº¿å®Œå…¨å¯ç”¨ï¼‰                  â”‚
â”‚                                                         â”‚
â”‚  ç§¯ç´¯ â†’ å¬å› â†’ æ¿€æ´» â†’ è¡¨è¾¾ â†’ ç§¯ç´¯...                     â”‚
â”‚  (Import) (Recall) (Activate) (Express)                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¿€æ´»ç¯èŠ‚çš„å®ç°æ–¹å¼:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åœ¨çº¿        â”‚      ç¦»çº¿        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI ç”Ÿæˆæ¿€æ´»å¡    â”‚  æ¨¡æ¿ + ç´ æå¡«å……  â”‚
â”‚  ä¸ªæ€§åŒ–é‚€è¯·      â”‚  é¢„è®¾é‚€è¯·è¯­       â”‚
â”‚  æ™ºèƒ½è¡¨è¾¾å»ºè®®    â”‚  é€šç”¨è¡¨è¾¾çŸ­è¯­åº“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AI è§’è‰²å®šä½

| åŠŸèƒ½ | AI ä¾èµ– | ç¦»çº¿æ–¹æ¡ˆ |
|------|---------|----------|
| ç´ æè¾“å…¥ | OCR (å¯é€‰) | æ‰‹åŠ¨è¾“å…¥ |
| å¬å›æ£€ç´¢ | âŒ ä¸ä¾èµ– | æœ¬åœ° Embedding + å…³é”®è¯ |
| æ¿€æ´»å¡ç”Ÿæˆ | å¢å¼ºä½“éªŒ | æ¨¡æ¿å…œåº• |
| Echo å¯¹è¯ | å¢å¼ºä½“éªŒ | è‡ªç”±è¾“å‡ºæ¨¡å¼ |
| èšç±»åˆ†æ | âŒ ä¸ä¾èµ– | æœ¬åœ° Embedding |
| Insights | âŒ ä¸ä¾èµ– | æœ¬åœ°è®¡ç®— |

---

## åŠŸèƒ½æ¨¡å—è®¾è®¡

### 1. å¬å›æ£€ç´¢æ¨¡å—

#### ä¸¤ç§æ£€ç´¢æ–¹å¼

| æ–¹å¼ | è§¦å‘ | å®ç° | ç”¨é€” |
|------|------|------|------|
| **å…³é”®è¯æœç´¢** | ç”¨æˆ·ä¸»åŠ¨è¾“å…¥ | å…¨æ–‡åŒ¹é… | ç²¾ç¡®æŸ¥æ‰¾ |
| **è¯­ä¹‰æ¨è** | ç³»ç»Ÿè‡ªåŠ¨ | Embedding ç›¸ä¼¼åº¦ | æ™ºèƒ½å‘ç° |

#### ç”¨æˆ·æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Practice é¡µé¢                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” [æœç´¢æ¡†: è¾“å…¥å…³é”®è¯...]              â”‚
â”‚                                         â”‚
â”‚  â”€â”€â”€ æˆ–è€…è®©ç³»ç»Ÿæ¨è â”€â”€â”€                  â”‚
â”‚                                         â”‚
â”‚  ğŸ“¦ åŸºäºä½ æœ€è¿‘çš„ç´ æï¼Œæ¨èç›¸å…³å†…å®¹:        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ æ¸¸æ³³ â”‚ â”‚ ç´§å¼  â”‚ â”‚ çªç ´ â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                         â”‚
â”‚  é€‰ä¸­çš„ç´ æ (3):                         â”‚
â”‚  â€¢ "æ°´ä¸­ç´§å¼ æ—¶è‚©è†€ä¼šåƒµç¡¬..."              â”‚
â”‚  â€¢ "æ”¾æ…¢èŠ‚å¥ååè€Œæ›´å¿«..."               â”‚
â”‚  â€¢ "èº«ä½“æ¯”æ„è¯†ååº”æ›´å¿«..."               â”‚
â”‚                                         â”‚
â”‚  [ç”Ÿæˆæ¿€æ´»å¡] æˆ– [ç›´æ¥å¼€å§‹è¾“å‡º]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯æ–¹æ¡ˆ

```typescript
// 1. å…³é”®è¯æœç´¢ - çº¯å‰ç«¯
function searchByKeyword(query: string, materials: RawMaterial[]) {
  const keywords = query.toLowerCase().split(/\s+/);
  return materials.filter(m =>
    keywords.some(k =>
      m.content.toLowerCase().includes(k) ||
      m.note?.toLowerCase().includes(k)
    )
  );
}

// 2. Embedding ç›¸ä¼¼åº¦ - æœ¬åœ°æ¨¡å‹
async function searchBySimilarity(query: string, materials: RawMaterial[]) {
  const queryEmbedding = await embed(query);
  return materials
    .map(m => ({
      material: m,
      score: cosineSimilarity(queryEmbedding, m.embedding)
    }))
    .sort((a, b) => b.score - a.score)
    .slice(0, 10);
}
```

### 2. Embedding æ–¹æ¡ˆ

#### æŠ€æœ¯é€‰å‹

| å¹³å° | æ–¹æ¡ˆ | æ¨¡å‹ | å¤§å° |
|------|------|------|------|
| Web | transformers.js | all-MiniLM-L6-v2 | ~25MB |
| React Native | ONNX Runtime | åŒä¸Š | ~25MB |
| æœåŠ¡ç«¯ | OpenAI / æœ¬åœ° | text-embedding-3-small | API |

#### å®ç°ç­–ç•¥

```typescript
// lib/embedding.ts

// 1. åˆå§‹åŒ–æœ¬åœ°æ¨¡å‹ (é¦–æ¬¡åŠ è½½)
let pipeline: Pipeline | null = null;

async function initEmbedding() {
  if (!pipeline) {
    const { pipeline: createPipeline } = await import('@xenova/transformers');
    pipeline = await createPipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');
  }
  return pipeline;
}

// 2. ç”Ÿæˆ Embedding
async function embed(text: string): Promise<number[]> {
  const model = await initEmbedding();
  const output = await model(text, { pooling: 'mean', normalize: true });
  return Array.from(output.data);
}

// 3. ç´ æå…¥åº“æ—¶è‡ªåŠ¨ç”Ÿæˆ Embedding
async function addMaterial(content: string, note?: string) {
  const embedding = await embed(content);
  await db.materials.insert({
    id: crypto.randomUUID(),
    content,
    note,
    embedding, // å­˜å‚¨å‘é‡
    createdAt: Date.now(),
  });
}
```

#### Embedding å­˜å‚¨

```sql
-- SQLite å­˜å‚¨æ–¹æ¡ˆ
CREATE TABLE materials (
  id TEXT PRIMARY KEY,
  content TEXT NOT NULL,
  note TEXT,
  embedding BLOB,  -- åºåˆ—åŒ–çš„ Float32Array
  created_at INTEGER
);

-- æˆ–ä½¿ç”¨ sqlite-vss æ‰©å±•æ”¯æŒå‘é‡ç´¢å¼•
```

### 3. èšç±»ä¸ç›¸ä¼¼åº¦

#### è‡ªåŠ¨èšç±»

```typescript
// ä½¿ç”¨ K-Means æˆ–å±‚æ¬¡èšç±»
interface Cluster {
  id: string;
  centroid: number[];      // èšç±»ä¸­å¿ƒå‘é‡
  label?: string;          // AI ç”Ÿæˆæˆ–ç”¨æˆ·å‘½å
  materialIds: string[];   // åŒ…å«çš„ç´ æ
}

// æ–°ç´ æå…¥åº“æ—¶:
// 1. è®¡ç®—ä¸ç°æœ‰èšç±»ä¸­å¿ƒçš„è·ç¦»
// 2. åŠ å…¥æœ€è¿‘çš„èšç±»ï¼Œæˆ–åˆ›å»ºæ–°èšç±»
// 3. æ›´æ–°èšç±»ä¸­å¿ƒ
```

#### ç›¸ä¼¼ç´ ææ¨è

```typescript
// å½“ç”¨æˆ·æŸ¥çœ‹æŸæ¡ç´ ææ—¶ï¼Œæ¨èç›¸ä¼¼å†…å®¹
async function getRelatedMaterials(materialId: string, limit = 5) {
  const material = await db.materials.get(materialId);
  const allMaterials = await db.materials.getAll();

  return allMaterials
    .filter(m => m.id !== materialId)
    .map(m => ({
      material: m,
      similarity: cosineSimilarity(material.embedding, m.embedding)
    }))
    .sort((a, b) => b.similarity - a.similarity)
    .slice(0, limit);
}
```

### 4. Insights åœ°å›¾

#### å¯è§†åŒ–è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Insights åœ°å›¾                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚         â—‹ â—‹                    â—‹                        â”‚
â”‚        â—‹ â— â—‹  [è¿åŠ¨/èº«ä½“]      â—‹ â—‹  [æƒ…ç»ª/æ„Ÿå—]          â”‚
â”‚         â—‹ â—‹                  â—‹ â— â—‹                      â”‚
â”‚           \                   /                         â”‚
â”‚            \                 /                          â”‚
â”‚             â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹                             â”‚
â”‚              [å­¦ä¹ /æˆé•¿]                                 â”‚
â”‚                   â— â—                                   â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  æ—¶é—´è½´: [2024.01 ----â—----â—----â—---- 2024.12]         â”‚
â”‚                                                         â”‚
â”‚  â— ç´ æç‚¹  â—‹ è¾“å‡ºç‚¹  â” èšç±»è¾¹ç•Œ  --- ç›¸ä¼¼è¿çº¿            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®ç»“æ„

```typescript
interface InsightsData {
  clusters: Cluster[];
  timeline: {
    date: string;
    materialCount: number;
    outputCount: number;
  }[];
  topThemes: {
    label: string;
    count: number;
    recentActivity: number;
  }[];
}
```

### 5. Activation Card æ¨¡æ¿å…œåº•

#### åˆ†çº§ç­–ç•¥

```typescript
async function generateActivationCard(materials: RawMaterial[]) {
  // 1. å°è¯• AI ç”Ÿæˆ
  if (isOnline() && hasAPIKey()) {
    try {
      return await aiGenerateCard(materials);
    } catch (e) {
      console.warn('AI generation failed, falling back to template');
    }
  }

  // 2. æ¨¡æ¿å…œåº•
  return generateFromTemplate(materials);
}

function generateFromTemplate(materials: RawMaterial[]): ActivationCard {
  const template = TEMPLATES[Math.floor(Math.random() * TEMPLATES.length)];
  const randomMaterial = materials[Math.floor(Math.random() * materials.length)];

  return {
    id: crypto.randomUUID(),
    emotionalAnchor: template.emotionalAnchor,
    livedExperience: randomMaterial.content,
    expressions: template.defaultExpressions,
    invitation: template.invitation,
    materialIds: materials.map(m => m.id),
    createdAt: Date.now(),
  };
}
```

#### æ¨¡æ¿åº“

```typescript
const TEMPLATES = [
  {
    emotionalAnchor: "å›æƒ³ä¸€ä¸‹å½“ä½ è®°å½•è¿™äº›æ—¶çš„åœºæ™¯...",
    invitation: "å¦‚æœè¦å‘ä¸€ä¸ªæœ‹å‹æè¿°è¿™ä¸ªæ„Ÿå—ï¼Œä½ ä¼šæ€ä¹ˆè¯´ï¼Ÿ",
    defaultExpressions: [
      "What I noticed was...",
      "It made me realize...",
      "The feeling was like...",
    ],
  },
  {
    emotionalAnchor: "è¿™äº›é›¶ç¢çš„è®°å½•èƒŒåï¼Œè—ç€ä¸€ä¸ªä½ å¾ˆåœ¨æ„çš„ä¸»é¢˜...",
    invitation: "è¯•ç€ç”¨ä¸€æ®µè¯æŠŠå®ƒè¯´å‡ºæ¥ï¼Ÿ",
    defaultExpressions: [
      "What matters to me is...",
      "I've been thinking about...",
      "This connects to...",
    ],
  },
  // æ›´å¤šæ¨¡æ¿...
];
```

---

## å®ç°ä¼˜å…ˆçº§

### Phase 1: å¬å›æ£€ç´¢åŸºç¡€ â¬…ï¸ å½“å‰

1. **å…³é”®è¯æœç´¢ UI**
   - Practice é¡µé¢æ·»åŠ æœç´¢æ¡†
   - å®æ—¶è¿‡æ»¤ç´ æåˆ—è¡¨

2. **æœ¬åœ° Embedding é›†æˆ**
   - é›†æˆ transformers.js
   - ç´ æå…¥åº“æ—¶ç”Ÿæˆ embedding
   - å­˜å‚¨åˆ° Zustand / åç»­æŒä¹…åŒ–

3. **è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢**
   - è¾“å…¥ query è®¡ç®—ç›¸ä¼¼ç´ æ
   - å±•ç¤ºç›¸ä¼¼åº¦æ’åºç»“æœ

### Phase 2: æ™ºèƒ½æ¨è

1. **è‡ªåŠ¨èšç±»**
   - K-Means æˆ–å±‚æ¬¡èšç±»
   - èšç±»æ ‡ç­¾ (AI ç”Ÿæˆæˆ–è§„åˆ™æå–)

2. **ç›¸ä¼¼ç´ ææ¨è**
   - æŸ¥çœ‹ç´ ææ—¶æ˜¾ç¤ºç›¸å…³å†…å®¹
   - "æ›´å¤šç±»ä¼¼å†…å®¹" å…¥å£

3. **Activation Card æ¨¡æ¿**
   - ç¦»çº¿æ¨¡æ¿åº“
   - ä¼˜é›…é™çº§é€»è¾‘

### Phase 3: Insights å¯è§†åŒ–

1. **æ•°æ®èšåˆ**
   - ä¸»é¢˜åˆ†å¸ƒç»Ÿè®¡
   - æ—¶é—´çº¿æ•°æ®

2. **å¯è§†åŒ–ç»„ä»¶**
   - èšç±»åœ°å›¾ (å¯è€ƒè™‘ D3.js / Recharts)
   - æ—¶é—´è½´

3. **ç”¨æˆ·æ´å¯Ÿ**
   - "ä½ æœ€è¿‘å…³æ³¨çš„ä¸»é¢˜"
   - "è¿™ä¸ªæœˆçš„æˆé•¿è½¨è¿¹"

---

## æŠ€æœ¯ä¾èµ–

### æ–°å¢ä¾èµ–

```json
{
  "@xenova/transformers": "^2.x",  // æµè§ˆå™¨ç«¯ embedding
  "d3": "^7.x",                    // Insights å¯è§†åŒ– (Phase 3)
}
```

### å­˜å‚¨æ‰©å±•

```typescript
// æ‰©å±• RawMaterial æ¨¡å‹
interface RawMaterial {
  id: string;
  type: 'text' | 'image';
  content: string;
  note?: string;
  embedding?: number[];  // æ–°å¢: å‘é‡è¡¨ç¤º
  clusterId?: string;    // æ–°å¢: æ‰€å±èšç±»
  createdAt: number;
}

// æ–°å¢ Cluster æ¨¡å‹
interface Cluster {
  id: string;
  label?: string;
  centroid: number[];
  materialIds: string[];
  createdAt: number;
  updatedAt: number;
}

// æ–°å¢ EchoOutput æ¨¡å‹ (ç”¨æˆ·çš„è¾“å‡º)
interface EchoOutput {
  id: string;
  sessionId: string;
  content: string;
  embedding?: number[];
  materialIds: string[];  // æ¥æºç´ æ
  createdAt: number;
}
```

---

## ç¦»çº¿ä½“éªŒå¯¹ç…§

| åŠŸèƒ½ | åœ¨çº¿ä½“éªŒ | ç¦»çº¿ä½“éªŒ |
|------|----------|----------|
| æ·»åŠ ç´ æ | OCR + æ‰‹åŠ¨ | ä»…æ‰‹åŠ¨è¾“å…¥ |
| å…³é”®è¯æœç´¢ | âœ… å®Œå…¨å¯ç”¨ | âœ… å®Œå…¨å¯ç”¨ |
| è¯­ä¹‰æœç´¢ | âœ… å®Œå…¨å¯ç”¨ | âœ… å®Œå…¨å¯ç”¨ (æœ¬åœ°æ¨¡å‹) |
| æ¿€æ´»å¡ | AI ç”Ÿæˆ | æ¨¡æ¿ç”Ÿæˆ |
| Echo å¯¹è¯ | AI åé¦ˆ | è‡ªç”±è¾“å‡º (æ— åé¦ˆ) |
| ä¿å­˜è¾“å‡º | âœ… å®Œå…¨å¯ç”¨ | âœ… å®Œå…¨å¯ç”¨ |
| Insights | âœ… å®Œå…¨å¯ç”¨ | âœ… å®Œå…¨å¯ç”¨ |
| èšç±»åˆ†æ | âœ… å®Œå…¨å¯ç”¨ | âœ… å®Œå…¨å¯ç”¨ |

**æ ¸å¿ƒä»·å€¼å¾ªç¯åœ¨ç¦»çº¿æ—¶ 100% å¯ç”¨ã€‚**
